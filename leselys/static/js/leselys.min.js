window.crel=(function(a){var b=typeof Node==='object'?function(a){return a instanceof Node;}:function(a){return a&&typeof a==='object'&&typeof a.nodeType==='number'&&typeof a.nodeName==='string';};function c(){var d=window.document,e=arguments,f=d.createElement(e[0]),g=e[1],h=2,i=e.length,j=c.attrMap;if(i===1)return f;if(typeof g!=='object'||b(g)){--h;g=null;}if((i-h)===1&&typeof e[h]==='string'&&f.textContent!==a)f.textContent=e[h];else for(;h<i;++h){child=e[h];if(child==null)continue;if(!b(child))child=d.createTextNode(child);f.appendChild(child);}for(var k in g)if(!j[k])f.setAttribute(k,g[k]);else{var l=c.attrMap[k];if(typeof l==='function')l(f,g[k]);else f.setAttribute(l,g[k]);}return f;}c.attrMap={};c.isNode=b;return c;})();(function(){function a(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c);}function b(a){return "keypress"==a.type?String.fromCharCode(a.which):j[a.which]?j[a.which]:k[a.which]?k[a.which]:String.fromCharCode(a.which).toLowerCase();}function c(a,b){a=a||{};var c=!1,d;for(d in q)a[d]&&q[d]>b?c=!0:q[d]=0;c||(t=!1);}function d(a,b,c,d,e){var f,h,i=[],j=c.type;if(!o[a])return [];"keyup"==j&&g(a)&&(b=[a]);for(f=0;f<o[a].length;++f)if(h=o[a][f],!(h.seq&&q[h.seq]!=h.level)&&j==h.action&&("keypress"==j&&!c.metaKey&&!c.ctrlKey||b.sort().join(",")===h.modifiers.sort().join(",")))d&&h.combo==e&&o[a].splice(f,1),i.push(h);return i;}function e(a,b,c){if(!v.stopCallback(b,b.target||b.srcElement,c)&&!1===a(b,c))b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation(),b.returnValue=!1,b.cancelBubble=!0;}function f(a){"number"!==typeof a.which&&(a.which=a.keyCode);var f=b(a);if(f)if("keyup"==a.type&&s==f)s=!1;else{var h=[];a.shiftKey&&h.push("shift");a.altKey&&h.push("alt");a.ctrlKey&&h.push("ctrl");a.metaKey&&h.push("meta");var h=d(f,h,a),i,j={},k=0,l=!1;for(i=0;i<h.length;++i)h[i].seq?(l=!0,k=Math.max(k,h[i].level),j[h[i].seq]=1,e(h[i].callback,a,h[i].combo)):!l&&!t&&e(h[i].callback,a,h[i].combo);a.type==t&&!g(f)&&c(j,k);}}function g(a){return "shift"==a||"ctrl"==a||"alt"==a||"meta"==a;}function h(a,b,c){if(!c){if(!n){n={};for(var d in j)95<d&&112>d||j.hasOwnProperty(d)&&(n[j[d]]=d);}c=n[a]?"keydown":"keypress";}"keypress"==c&&b.length&&(c="keydown");return c;}function i(a,f,j,k,n){p[a+":"+j]=f;a=a.replace(/\s+/g," ");var u=a.split(" "),v,w,x=[];if(1<u.length){var y=a,z=j;q[y]=0;z||(z=h(u[0],[]));a=function(){t=z;++q[y];clearTimeout(r);r=setTimeout(c,1E3);};j=function(a){e(f,a,y);"keyup"!==z&&(s=b(a));setTimeout(c,10);};for(k=0;k<u.length;++k)i(u[k],k<u.length-1?a:j,z,y,k);}else{w="+"===a?["+"]:a.split("+");for(u=0;u<w.length;++u)v=w[u],m[v]&&(v=m[v]),j&&("keypress"!=j&&l[v])&&(v=l[v],x.push("shift")),g(v)&&x.push(v);j=h(v,x,j);o[v]||(o[v]=[]);d(v,x,{type:j},!k,a);o[v][k?"unshift":"push"]({callback:f,modifiers:x,action:j,seq:k,level:n,combo:a});}}for(var j={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},k={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},l={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},m={option:"alt",command:"meta","return":"enter",escape:"esc"},n,o={},p={},q={},r,s=!1,t=!1,u=1;20>u;++u)j[111+u]="f"+u;for(u=0;9>=u;++u)j[u+96]=u;a(document,"keypress",f);a(document,"keydown",f);a(document,"keyup",f);var v={bind:function(a,b,c){a=a instanceof Array?a:[a];for(var d=0;d<a.length;++d)i(a[d],b,c);return this;},unbind:function(a,b){return v.bind(a,function(){},b);},trigger:function(a,b){if(p[a+":"+b])p[a+":"+b]();return this;},reset:function(){o={};p={};return this;},stopCallback:function(a,b){return -1<(" "+b.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.contentEditable&&"true"==b.contentEditable;}};window.Mousetrap=v;"function"===typeof define&&define.amd&&define(v);})();TINY={};TINY.box=function(){var a,b,c,d,e,f=0;return{show:function(g){e={opacity:70,close:1,animate:1,fixed:1,mask:1,maskid:'',boxid:'',topsplit:2,url:0,post:0,height:0,width:0,html:0,iframe:0};for(s in g)e[s]=g[s];if(!f){a=document.createElement('div');a.className='tbox';f=document.createElement('div');f.className='tinner';c=document.createElement('div');c.className='tcontent';b=document.createElement('div');b.className='tmask';d=document.createElement('div');d.className='tclose';d.v=0;document.body.appendChild(b);document.body.appendChild(a);a.appendChild(f);f.appendChild(c);b.onclick=d.onclick=TINY.box.hide;window.onresize=TINY.box.resize;}else{a.style.display='none';clearTimeout(f.ah);if(d.v){f.removeChild(d);d.v=0;}}f.id=e.boxid;b.id=e.maskid;a.style.position=e.fixed?'fixed':'absolute';if(e.html&&!e.animate){f.style.backgroundImage='none';c.innerHTML=e.html;c.style.display='';f.style.width=e.width?e.width+'px':'auto';f.style.height=e.height?e.height+'px':'auto';}else{c.style.display='none';if(!e.animate&&e.width&&e.height){f.style.width=e.width+'px';f.style.height=e.height+'px';}else f.style.width=f.style.height='100px';}if(e.mask){this.mask();this.alpha(b,1,e.opacity);}else this.alpha(a,1,100);if(e.autohide)f.ah=setTimeout(TINY.box.hide,1000*e.autohide);else document.onkeyup=TINY.box.esc;if(e.mask)document.getElementsByTagName('body')[0].style.overflow="hidden";;},fill:function(a,b,c,d,g,h){if(b){if(e.image){var i=new Image();i.onload=function(){g=g||i.width;h=h||i.height;TINY.box.psh(i,d,g,h);};i.src=e.image;}else if(e.iframe)this.psh('<iframe src="'+e.iframe+'" width="'+e.width+'" frameborder="0" height="'+e.height+'"></iframe>',d,g,h);else{var j=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject('Microsoft.XMLHTTP');j.onreadystatechange=function(){if(j.readyState==4&&j.status==200){f.style.backgroundImage='';TINY.box.psh(j.responseText,d,g,h);}};if(c){j.open('POST',a,true);j.setRequestHeader('Content-type','application/x-www-form-urlencoded');j.send(c);}else{j.open('GET',a,true);j.send(null);}}}else this.psh(a,d,g,h);},psh:function(a,b,d,e){if(typeof a=='object')c.appendChild(a);else c.innerHTML=a;var g=f.style.width,h=f.style.height;if(!d||!e){f.style.width=d?d+'px':'';f.style.height=e?e+'px':'';c.style.display='';if(!e)e=parseInt(c.offsetHeight);if(!d)d=parseInt(c.offsetWidth);c.style.display='none';}f.style.width=g;f.style.height=h;this.size(d,e,b);},esc:function(a){a=a||window.event;if(a.keyCode==27)TINY.box.hide();},hide:function(){TINY.box.alpha(a,-1,0,3);document.onkeypress=null;if(e.closejs)e.closejs();;document.getElementsByTagName('body')[0].style.overflow="";},resize:function(){TINY.box.pos();TINY.box.mask();},mask:function(){},pos:function(){var b;if(typeof e.top!='undefined')b=e.top;else{b=(this.height()/e.topsplit)-(a.offsetHeight/2);b=b<20?20:b;}if(!e.fixed&&!e.top)b+=this.top();a.style.top=b+'px';a.style.left=typeof e.left!='undefined'?e.left+'px':(this.width()/2)-(a.offsetWidth/2)+'px';},alpha:function(a,b,c){clearInterval(a.ai);if(b){a.style.opacity=0;a.style.filter='alpha(opacity=0)';a.style.display='block';TINY.box.pos();}a.ai=setInterval(function(){TINY.box.ta(a,c,b);},20);},ta:function(d,g,h){var i=Math.round(d.style.opacity*100);if(i==g){clearInterval(d.ai);if(h==-1){d.style.display='none';d==a?TINY.box.alpha(b,-1,0,2):c.innerHTML=f.style.backgroundImage='';}else if(d==b)this.alpha(a,1,100);else{a.style.filter='';TINY.box.fill(e.html||e.url,e.url||e.iframe||e.image,e.post,e.animate,e.width,e.height);}}else{var j=g-Math.floor(Math.abs(g-i)*.5)*h;d.style.opacity=j/100;d.style.filter='alpha(opacity='+j+')';}},size:function(a,b,g){if(g){clearInterval(f.si);var h=parseInt(f.style.width)>a?-1:1,i=parseInt(f.style.height)>b?-1:1;f.si=setInterval(function(){TINY.box.ts(a,h,b,i);},20);}else{f.style.backgroundImage='none';if(e.close){f.appendChild(d);d.v=1;}f.style.width=a+'px';f.style.height=b+'px';c.style.display='';this.pos();if(e.openjs)e.openjs();}},ts:function(a,b,g,h){var i=parseInt(f.style.width),j=parseInt(f.style.height);if(i==a&&j==g){clearInterval(f.si);f.style.backgroundImage='none';c.style.display='block';if(e.close){f.appendChild(d);d.v=1;}if(e.openjs)e.openjs();}else{if(i!=a)f.style.width=(a-Math.floor(Math.abs(a-i)*.6)*b)+'px';if(j!=g)f.style.height=(g-Math.floor(Math.abs(g-j)*.6)*h)+'px';this.pos();}},top:function(){return document.documentElement.scrollTop||document.body.scrollTop;},width:function(){return self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;},height:function(){return self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;},total:function(a){var b=document.body,c=document.documentElement;return a?Math.max(Math.max(b.scrollHeight,c.scrollHeight),Math.max(b.clientHeight,c.clientHeight)):Math.max(Math.max(b.scrollWidth,c.scrollWidth),Math.max(b.clientWidth,c.clientWidth));}};}();function getXMLHttpRequest(){var a=null;if(window.XMLHttpRequest||window.ActiveXObject)if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP");}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP");}else a=new XMLHttpRequest();else{alert("Browser not supported (XMLHTTPRequest).");return null;}return a;}function ajaxRequest(a){if(a==undefined)return false;var b={url:undefined,method:"GET",params:{},callback:undefined,headers:{}};for(var c in b)if(!a[c])a[c]=b[c];if(a.url==undefined)return false;var d=getXMLHttpRequest();d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200||d.status==0){var b=d.responseText;try{b=JSON.parse(b);}catch(c){window.location="/";};if(a.callback)a.callback(d,b);}else{var b={success:false,content:{}};if(a.callback)a.callback(d,b);}};var e="";for(var c in a.params)e+="&"+c+"="+a.params[c];if(e.length)e=e.substr(1-e.length);if(e.length&&a.method=="GET")a.url+="?"+e;d.open(a.method,a.url,true);if(a.method=="POST")d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var c in a.headers)d.setRequestHeader(c,a.headers[c]);if(a.method=="GET")d.send(null);else if(a.method=="POST")d.send(e);else d.send(null);return d;}api={};api.addFeed=function(a,b){return ajaxRequest({url:'/api/add',method:'POST',params:{url:a},callback:b});};api.deleteFeed=function(a,b){return ajaxRequest({url:'/api/remove/'+a,method:'DELETE',callback:b});};api.setFeedSetting=function(a,b,c,d){return ajaxRequest({url:'/api/feedsettings',method:'POST',params:{feed_id:a,key:b,value:c},callback:d});};api.importOPML=function(a,b){return ajaxRequest({url:'/api/import/opml',method:'POST',params:{file:a},callback:b});};api.getSettings=function(a){return ajaxRequest({url:'/settings',method:'GET',params:{jsonify:true},callback:a});};api.getHome=function(a){return ajaxRequest({url:'/',method:'GET',params:{jsonify:true},callback:a});};api.getFeed=function(a,b){return ajaxRequest({url:'/api/get/'+a,method:'GET',callback:b});};api.readStory=function(a,b){return ajaxRequest({url:'/api/read/'+a,method:'GET',callback:b});};api.unreadStory=function(a,b){return ajaxRequest({url:'/api/unread/'+a,method:'GET',callback:b});};api.setTheme=function(a,b){return ajaxRequest({url:'api/settings/theme',method:'POST',params:{theme:a},callback:b});};api.getCounters=function(a){return ajaxRequest({url:'/api/counters',method:'GET',callback:a});};api.markAllAsRead=function(a,b){return ajaxRequest({url:'/api/all_read/'+a,method:'GET',callback:b});};api.markAllAsUnread=function(a,b){return ajaxRequest({url:'/api/all_unread/'+a,method:'GET',callback:b});};requests=new Array();importer=false;setKeyboard();function addFeed(){var a=document.getElementById('urlFeed').value;if(a=='')return false;document.getElementById('add').style.display="none";document.getElementById('urlFeed').value="";if(document.getElementById('menu').getElementsByClassName('empty-feed-list')){document.getElementById('menu').getElementsByClassName('empty-feed-list')[0].style.display="none";document.getElementById('menu').getElementsByClassName('feeds-list-title')[0].style.display="";}var b=crel("li",crel("i",{"class":"icon-tasks"})," Loading...");b.style.display="none";b=document.getElementById('menu').appendChild(b);b.style.display="";api.addFeed(a,function(a,c){if(c.success){var d=c.feed_id;var e=c.title;var f=c.url;var g=c.counter;var h=crel('a',{'onClick':'viewFeed("'+d+'")','href':'/#'+d},e+" ",crel('span',{'class':'unread-counter muted'},'('+g+')'));b.style.display="none";b.innerHTML=h.outerHTML;b.id=d;b.classList.add('feed');b.style.display="";if(g>0)b.classList.add('unread');if(document.getElementById('feeds-settings')){if(document.getElementById('feeds-settings').getElementsByClassName('empty-feed-list'))document.getElementById('feeds-settings').getElementsByClassName('empty-feed-list')[0].style.display="none";var i=crel('li',{'id':d+"-feeds-settings"},e,' (',crel('a',{'class':'muted','href':'#','onClick':'deleteFeed("'+d+'")'},'remove'),') - ',crel('a',{'href':f,'target':'_blank'},f));i.style.display="none";i=document.getElementById('feeds-settings').getElementsByTagName('ul')[0].appendChild(i);i.style.display="";}}else{if(c.callback=="/api/login")window.location="/login";b.innerHTML='<li><i class="icon-exclamation-sign"></i> Error: '+c.output+'</li>';var j=function(){b.style.display="none";};setTimeout(j,5000);}});}function setFeedSetting(a,b,c){api.setFeedSetting(a,b,c,function(b,c){if(c.success)viewFeed(a);});var d=getXMLHttpRequest();d.onreadystatechange=function(){if(d.readyState==4&&(d.status==200||d.status==0)){var b=JSON.parse(d.responseText);if(b.success==true)viewFeed(a);}};}function handleOPMLImport(a){if(document.getElementById("upload-file-info").innerHTML=="")return false;if(importer)return false;if(window.File&&window.FileReader&&window.FileList&&window.Blob){}else{alert('The File APIs are not fully supported in this browser.');return false;}importer=true;var b=document.getElementById('OPMLFile').files[0];if(!b)return false;var c=new FileReader();c.onload=(function(a){return function(a){api.importOPML(a.target.result,function(a,b){if(b.success){importer=false;document.getElementById("OPMLSubmit").innerHTML="Importing, reload page later...";document.getElementById("OPMLSubmit").className+=" disabled";}else{if(b.callback=="/api/login")window.location="/login";document.getElementById("OPMLSubmit").innerHTML="Error: "+b.output;document.getElementById("OPMLSubmit").className+=" disabled";}});};})(b);c.readAsText(b);}function viewSettings(a){api.getSettings(function(b,c){if(c.success){var d=new DOMParser();var e=d.parseFromString(c.content,"text/html");var f=e.getElementById('content');var g=e.getElementById('menu');document.getElementById("content").innerHTML=f.innerHTML;document.getElementById("menu").innerHTML=g.innerHTML;if(importer){document.getElementById("OPMLSubmit").innerHTML="Last import not finished...";document.getElementById("OPMLSubmit").className+=" disabled";return false;}if(document.getElementById("OPMLSubmit"))document.getElementById('OPMLSubmit').addEventListener('click',handleOPMLImport,false);initPage();initTabs();initSettingsView();if(typeof a!="undefined")a();disableRibbon();}else if(c.callback=="/api/login")window.location="/login";});}function viewHome(a){api.getHome(function(b,c){if(c.sucess){var d=new DOMParser();var e=d.parseFromString(c.content,"text/html");var f=e.getElementById('content');var g=e.getElementById('menu');document.getElementById("content").innerHTML=f.innerHTML;document.getElementById("menu").innerHTML=g.innerHTML;initPage();if(typeof a!="undefined")a();disableRibbon();}else if(c.callback=="/api/login")window.location="/login";});}function deleteFeed(a){api.deleteFeed(a,function(b,c){if(c.success){document.getElementById(a).style.display="none";var d=document.getElementById(a);var e=document.getElementById(a).parentNode;e.removeChild(d);var f=document.getElementById('feeds-settings');if(typeof f!='undefined'){var d=document.getElementById(a+"-settings");var e=document.getElementById(a+"-settings").parentNode;e.removeChild(d);if(f.getElementsByTagName('li').length<1)document.getElementById('feeds-settings').getElementsByClassName('empty-feed-list')[0].style.display="";}var f=document.getElementById('menu').getElementsByClassName('feed');if(f.length<1){document.getElementById('menu').getElementsByClassName('feeds-list-title')[0].style.display="none";document.getElementById('menu').getElementsByClassName('empty-feed-list')[0].style.display="";}}else{if(c.callback=="/api/login")window.location="/login";window.location="/";}});}function viewFeed(a,b){for(var c=0;c<requests.length;c++){requests[c].abort();requests.shift();}var d=api.getFeed(a,function(c,d){if(d.success){var e=crel('div',{'class':'accordion','id':'story-list-accordion'});var f='';if(d.content.length==0)f='<p style="text-align:center; margin-top: 50px"><em>Oups, there is no story here...</em></p>';for(var g=0;g<d.content.entries.length;g++){var h=d.content.entries[g];var i=h._id;var j=h.title;var k=getStoryAccordionTemplate();var l=h.read;k.id=i;k.getElementsByClassName("accordion-toggle")[0].setAttribute('onclick','readStory("'+i+'")');k.getElementsByClassName("accordion-toggle")[0].innerHTML=j;if(l==false){k.getElementsByClassName('accordion-toggle')[0].style.fontWeight="bold";k.classList.add('unread-story');}f+=k.outerHTML;}e.innerHTML=f;document.getElementById('content').innerHTML=e.outerHTML;var m=document.getElementById('menu').getElementsByTagName('a');for(g=0;g<m.length;g++)m[g].classList.remove('text-error');document.getElementById(a).getElementsByTagName('a')[0].classList.add('text-error');initAccordion();enableRibbon(a,d.content.ordering);if(typeof b!="undefined")b();}else{if(d.callback=="/api/login")window.location="/login";window.location="/";}});requests.push(d);}function readStory(a,b){var b=b||false;if(b==true){document.getElementById(a).getElementsByClassName("accordion-toggle")[0].setAttribute('onclick','readStory("'+a+'")');return true;}var c=document.getElementById(a);c.classList.add('selected-story');for(var d=0;d<document.getElementsByClassName('accordion-group').length;d++){var e=document.getElementsByClassName('accordion-group')[d];if(e.getAttribute('id')!=a)e.classList.remove('selected-story');}if(document.getElementById(a).getElementsByClassName('accordion-inner')[0].innerHTML=="")document.getElementById(a).getElementsByClassName('accordion-inner')[0].innerHTML='<center><i class="icon-spinner icon-spin icon-3x"></i></center>';api.readStory(a,function(b,c){if(!c.success)if(c.callback=="/api/login")window.location="/login";if(c.content.last_update==false)var d="No date";else{if(c.content.last_update.min.toString().length==1)var e="0"+c.content.last_update.min;else var e=c.content.last_update.min;if(c.content.last_update.hour.toString().length==1)var f="0"+c.content.last_update.hour;else var f=c.content.last_update.hour;var d=c.content.last_update.year+'-'+c.content.last_update.month+'-'+c.content.last_update.day+"  "+f+":"+e;}var g=c.content.feed_id;var h=getStoryTemplate();h.getElementsByClassName("story-link")[0].href=c.content.link;h.getElementsByClassName("story-read-toggle")[0].setAttribute('onclick','unreadStory("'+a+'")');h.getElementsByClassName("story-read-toggle")[0].innerHTML='Mark as unread';h.getElementsByClassName("story-read-toggle")[0].href="#"+a;h.getElementsByClassName("story-content")[0].innerHTML=c.content.description;h.getElementsByClassName("story-date")[0].innerHTML=d;document.getElementById(a).getElementsByClassName("accordion-inner")[0].innerHTML=h.innerHTML;document.getElementById(a).getElementsByClassName("story-read-toggle")[0].addEventListener('click',function(a){a.preventDefault();},false);if(c.success){document.getElementById(a).classList.remove('unread-story');var i=cleanCounter(document.getElementById(g).getElementsByClassName('unread-counter')[0].innerHTML);var i=i-1;document.getElementById(g).getElementsByClassName('unread-counter')[0].innerHTML='('+i+')';if(i==0){document.getElementById(g).getElementsByClassName('unread-counter')[0].style.display="none";document.getElementById(g).classList.remove('unread');document.getElementById(g).style.fontWeight='normal';}}});document.getElementById(a).getElementsByClassName("accordion-toggle")[0].style.fontWeight='normal';}function unreadStory(a){api.unreadStory(a,function(b,c){if(c.success){var d=c.content.feed_id;var e=document.getElementById(a);e.classList.add('unread-story');document.getElementById(a).getElementsByClassName("accordion-toggle")[0].setAttribute('onclick','readStory("'+a+'", true)');e.getElementsByClassName("story-read-toggle")[0].setAttribute('onclick','readStory("'+a+'")');e.getElementsByClassName("story-read-toggle")[0].innerHTML='Mark as read';var f=cleanCounter(document.getElementById(d).getElementsByClassName('unread-counter')[0].innerHTML);f=f+1;if(f>0){document.getElementById(d).getElementsByClassName('unread-counter')[0].innerHTML='('+f+')';document.getElementById(d).getElementsByClassName('unread-counter')[0].style.display="";if(!document.getElementById(d).classList.contains('unread'))document.getElementById(d).classList.add('unread');}else{document.getElementById(d).classList.remove('unread');document.getElementById(d).getElementsByClassName('unread-counter')[0].innerHTML='('+f+')';}document.getElementById(a).getElementsByClassName("accordion-toggle")[0].style.fontWeight='bold';}else if(c.callback=="/api/login")window.location="/login";});}function loadTheme(a,b){api.setTheme(a,function(a,b){window.location="/";});}function refreshCounters(){api.getCounters(function(a,b){if(b.success)for(i=0;i<b.content.length;i++){var c=b.content[i];var d=c[0];var e=c[1];document.getElementById(d).getElementsByClassName('unread-counter')[0].innerHTML='('+e+')';if(e>0){document.getElementById(d).classList.add('unread');document.getElementById(d).getElementsByClassName('unread-counter')[0].style.display="";}else{document.getElementById(d).classList.remove('unread');document.getElementById(d).getElementsByClassName('unread-counter')[0].style.display="none";}}else if(b.callback=="/api/login")window.location="/login";});}function initAddFeed(){var a=getAddFeedTemplate();document.getElementById('menu').appendChild(a);}function initSettingsView(){document.getElementById('OPMLSubmit').addEventListener('click',handleOPMLImport,false);document.getElementById('OPMLFile').addEventListener('change',function(){document.getElementById('upload-file-info').innerHTML=document.getElementById('OPMLFile').value.replace("C:\\fakepath\\","");});}function initPage(){var a=document.getElementById('menu').getElementsByClassName('feed');addEventListenerList(a,'click',function(a){a.preventDefault();});initAddFeed();setInterval(refreshCounters,120000);}function initTabs(){for(var a=0;a<document.getElementsByClassName('tabbable').length;a++){var b=document.getElementsByClassName('tabbable')[a];for(var c=0;c<b.getElementsByClassName('nav-tabs')[0].getElementsByTagName('li').length;c++){var d=b.getElementsByClassName('nav-tabs')[0].getElementsByTagName('li')[c];var e=d.getElementsByTagName('a')[0].getAttribute('href').substr(1);var f=document.getElementById(e);if(!f.classList.contains('active'))f.style.display="none";d.getElementsByTagName('a')[0].addEventListener('click',function(a){var b=this.getAttribute('href').substr(1);var c=document.getElementById(b);this.parentNode.classList.add('active');c.classList.add('active');c.style.display="block";hideTabs(this.parentNode);a.preventDefault();});}}}function hideTabs(a){var b=a.getElementsByTagName('a')[0].getAttribute('href').substr(1);var c=a.parentNode.parentNode;for(var d=0;d<c.getElementsByClassName('nav-tabs')[0].getElementsByTagName('li').length;d++){var a=c.getElementsByClassName('nav-tabs')[0].getElementsByTagName('li')[d];var e=a.getElementsByTagName('a')[0].getAttribute('href').substr(1);if(e!=b){a.classList.remove('active');document.getElementById(e).classList.remove('active');document.getElementById(e).style.display="none";}}}function initAccordion(){for(var a=0;a<document.getElementsByClassName('accordion').length;a++){var b=document.getElementsByClassName('accordion')[a];for(var c=0;c<b.getElementsByClassName('accordion-group').length;c++){var d=b.getElementsByClassName('accordion-group')[c];var e=d.getElementsByClassName('accordion-heading')[0];var f=d.getElementsByClassName('accordion-inner')[0];e.style.height="auto";e.addEventListener('click',function(){var a=this.parentNode.getElementsByClassName('accordion-inner')[0];if(a.style.display=="")a.style.display="none";else{a.style.display="";a.style.height="auto";collapseIn(this.parentNode);}});f.style.display="none";f.style.height="0px";f.style.overflow="hidden";}}}function collapseIn(a){var b=a.parentNode;for(var c=0;c<b.getElementsByClassName('accordion-group').length;c++){var d=b.getElementsByClassName('accordion-group')[c];if(d!=a){var e=d.getElementsByClassName('accordion-heading')[0];var f=d.getElementsByClassName('accordion-inner')[0];f.style.display="none";f.style.height="0px";}}}function markAllAsRead(a){api.markAllAsRead(a,function(b,c){viewFeed(a,refreshCounters);});}function markAllAsUnread(a){api.markAllAsUnread(a,function(b,c){viewFeed(a,refreshCounters);});}function enableRibbon(a,b){var c=document.getElementById('ribbon');c.style.display="";if(b=="unreaded"){c.getElementsByClassName('order-unreaded')[0].classList.add('active');c.getElementsByClassName('order-published')[0].classList.remove('active');}else if(b=="published"){c.getElementsByClassName('order-unreaded')[0].classList.remove('active');c.getElementsByClassName('order-published')[0].classList.add('active');}c.getElementsByClassName('order-unreaded')[0].getElementsByTagName('a')[0].onclick=function(){setFeedSetting(a,'ordering','unreaded');};c.getElementsByClassName('order-published')[0].getElementsByTagName('a')[0].onclick=function(){setFeedSetting(a,'ordering','published');};c.getElementsByClassName('mark-all-as-read')[0].getElementsByTagName('a')[0].onclick=function(){var b="markAllAsRead(\""+a+"\");TINY.box.hide();";var c=getMarkAllConfirmationTemplate('Mark all as read ?',a,b);TINY.box.show({'html':c.outerHTML,maskopacity:40,maskid:'confirmation-mask'});};c.getElementsByClassName('mark-all-as-unread')[0].getElementsByTagName('a')[0].onclick=function(){var b="markAllAsUnread(\""+a+"\");TINY.box.hide();";var c=getMarkAllConfirmationTemplate('Mark all as unread ?',a,b);TINY.box.show({'html':c.outerHTML,maskopacity:40,maskid:'confirmation-mask'});};}function disableRibbon(){var a=document.getElementById('ribbon');a.style.display="none";}function getCurrentStory(){var a=document.getElementsByClassName('selected-story')[0];if(typeof a==="undefined")return false;return a;}function getNextStory(){var a=document.getElementsByClassName('selected-story')[0];if(typeof a==="undefined")return false;if(a.nextSibling==null)return false;return a.nextSibling;}function getPreviousStory(){var a=document.getElementsByClassName('selected-story')[0];if(typeof a==="undefined")return false;if(a.previousSibling==null)return false;return a.previousSibling;}function toggleReadState(a){console.log(a);var b=document.getElementById(a);if(b.classList.contains('unread-story'))readStory(a);else unreadStory(a);}function setKeyboard(){Mousetrap.bind('g h',function(){viewHome();});Mousetrap.bind('r',function(){refreshCounters();});Mousetrap.bind('a',function(){addToggle();});Mousetrap.bind('?',function(){viewSettings(function(){var a=document.getElementById('content').getElementsByClassName('nav-tabs')[0].getElementsByTagName('li');var b=document.getElementById('content').getElementsByClassName('tab-content')[0].getElementsByClassName('tab-pane');for(i=0;i<a.length;i++){a[i].classList.remove('active');b[i].classList.remove('active');if(a[i].getElementsByTagName('a')[0].getAttribute('href')=='#help'){a[i].classList.add('active');b[i].classList.add('active');b[i].style.display="block";}}});});Mousetrap.bind('m',function(){var a=getCurrentStory();if(a==false)return;toggleReadState(a.getAttribute('id'));});Mousetrap.bind('o',function(){var a=getCurrentStory();if(a==false)return;a.getElementsByTagName('a')[0].click();});Mousetrap.bind('j',function(){var a=getNextStory();if(a==false)return;a.getElementsByTagName('a')[0].click();});Mousetrap.bind('k',function(){var a=getPreviousStory();if(a==false)return;a.getElementsByTagName('a')[0].click();});}function addEventListenerList(a,b,c){for(var d=0,e=a.length;d<e;d++)a[d].addEventListener(b,c,false);}function addToggle(){var a=document.getElementById('add');if(a.style.display=="block")a.style.display="none";else a.style.display="block";document.getElementById('urlFeed').focus();}function cleanCounter(a){return parseInt(a.substr(1,a.length-2));}(function(a){"use strict";var b=a.prototype,c=b.parseFromString;try{if(new a().parseFromString("","text/html"))return;}catch(d){}b.parseFromString=function(a,b){if(/^\s*text\/html\s*(?:;|$)/i.test(b)){var d=document.implementation.createHTMLDocument("");d.body.innerHTML=a;return d;}else return c.apply(this,arguments);};}(DOMParser));"use strict";if(typeof document!=="undefined"&&!("classList" in document.createElement("a")))(function(a){var b="classList",c="prototype",d=(a.HTMLElement||a.Element)[c],e=Object;strTrim=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"");},arrIndexOf=Array[c].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return -1;},DOMEx=function(a,b){this.name=a;this.code=DOMException[a];this.message=b;},checkTokenAndGetIndex=function(a,b){if(b==="")throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");return arrIndexOf.call(a,b);},ClassList=function(a){var b=strTrim.call(a.className),c=b?b.split(/\s+/):[];for(var d=0,e=c.length;d<e;d++)this.push(c[d]);this._updateClassName=function(){a.className=this.toString();};},classListProto=ClassList[c]=[],classListGetter=function(){return new ClassList(this);};DOMEx[c]=Error[c];classListProto.item=function(a){return this[a]||null;};classListProto.contains=function(a){a+="";return checkTokenAndGetIndex(this,a)!==-1;};classListProto.add=function(a){a+="";if(checkTokenAndGetIndex(this,a)===-1){this.push(a);this._updateClassName();}};classListProto.remove=function(a){a+="";var b=checkTokenAndGetIndex(this,a);if(b!==-1){this.splice(b,1);this._updateClassName();}};classListProto.toggle=function(a){a+="";if(checkTokenAndGetIndex(this,a)===-1)this.add(a);else this.remove(a);};classListProto.toString=function(){return this.join(" ");};if(e.defineProperty){var f={get:classListGetter,enumerable:true,configurable:true};try{e.defineProperty(d,b,f);}catch(g){if(g.number===-2146823252){f.enumerable=false;e.defineProperty(d,b,f);}}}else if(e[c].__defineGetter__)d.__defineGetter__(b,classListGetter);}(self));;